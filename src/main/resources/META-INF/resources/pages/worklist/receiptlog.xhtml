<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:histo="http://java.sun.com/jsf/composite/components/notification"
                xmlns:hm="http://java.sun.com/jsf/composite/components/miscellaneous">

    <h:outputScript library="scripts" name="closeOverlayPanelOnReturn.js"/>
    <h:outputScript library="scripts" name="commonFunctions.js"/>

    <ui:include src="include/navigationBar.xhtml"/>

    <p:panel style="width: 80%"
             styleClass="defaultHistoHiddenTableContainer">

        <h:outputLabel value="#{msg['body.receiptlog.taskId']} #{receiptLogView.task.taskID}"
                       style="font-size:1.5em;"/>
        <div class="ui-g ui-g-nopad">
            <!-- ##################### LEFT ##################### -->
            <div class="ui-g-4">
                <div class="ui-g ui-g-nopad">
                    <!-- ##################### Receipt Date ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.receiptlog.taskEDate']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:calendar pattern="dd.MM.yyyy" mask="true" id="receiptDate" converter="localDateConverter"
                                    style="width: 80%;background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor}"
                                    styleClass="customBackground"
                                    disabled="#{!receiptLogView.task.taskStatus.editable}"
                                    value="#{receiptLogView.task.receiptDate}">
                            <p:ajax event="dateSelect"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.receiptDate',receiptLogView.task.receiptDate)}"
                                    update="receiptDate"/>
                            <f:ajax event="change" execute="@this" render="receiptDate"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.receiptDate',receiptLogView.task.receiptDate)}"/>
                        </p:calendar>
                    </div>
                    <!-- ##################### Termin Date ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.receiptlog.taskDueDate']}"/>
                    </div>
                    <div class="ui-g-1 ui-g-vCenter">
                        <p:selectBooleanCheckbox style="padding-right:5px;"
                                                 disabled="#{!receiptLogView.task.taskStatus.editable}"
                                                 title="#{msg['body.receiptlog.taskDueDate.hint']}"
                                                 value="#{receiptLogView.task.dueDateSelected}">
                            <p:ajax event="change" execute="@this"
                                    update="navigationForm:patientList contentForm:contentPanel"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.dueDate.use',receiptLogView.task.dueDateSelected)}">
                            </p:ajax>

                        </p:selectBooleanCheckbox>
                    </div>
                    <div class="ui-g-7">
                        <p:calendar pattern="dd.MM.yyyy" mask="true" id="dueDate"
                                    style="width: 80%;background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor};"
                                    styleClass="customBackground" converter="localDateConverter"
                                    value="#{receiptLogView.task.dueDate}"
                                    disabled="#{!receiptLogView.task.dueDateSelected or !receiptLogView.task.taskStatus.editable}">
                            <p:ajax event="dateSelect"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.dueDate.date',receiptLogView.task.dueDate)}"
                                    update="dueDate"/>
                            <f:ajax event="change" execute="@this" render="dueDate"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.dueDate.date',receiptLogView.task.dueDate)}"/>
                        </p:calendar>
                    </div>
                    <!-- ##################### ward ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.ward']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:selectOneMenu id="wards"
                                         value="#{receiptLogView.task.ward}"
                                         style="width: 80%;background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor};"
                                         styleClass="customBackground" editable="true"
                                         disabled="#{!receiptLogView.task.taskStatus.editable}">
                            <f:selectItems
                                    value="#{genericViewData.wardList}"
                                    itemValue="#{ward.value}" itemLabel="#{ward.value}" var="ward"/>
                            <p:ajax event="change" execute="@this"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.ward',receiptLogView.task.ward)}"/>
                        </p:selectOneMenu>
                    </div>
                    <!-- ##################### EYE ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.receiptlog.eye']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:selectOneMenu
                                style="width: 80%;background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor};"
                                styleClass="customBackground"
                                value="#{receiptLogView.task.eye}"
                                disabled="#{!receiptLogView.task.taskStatus.editable}">

                            <f:selectItems value="#{enumProvider.eyes}" var="eye"
                                           itemLabel="#{msg['enum.eye.'.concat(eye)]}" itemValue="#{eye}"/>

                            <p:ajax event="change" execute="@this"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.eye',receiptLogView.task.eye)}"/>
                        </p:selectOneMenu>
                    </div>
                    <!-- ##################### History ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.receiptlog.story']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:inputTextarea styleClass="customBackground"
                                         disabled="#{!receiptLogView.task.taskStatus.editable}"
                                         value="#{receiptLogView.task.caseHistory}"
                                         title="#{msg['body.diagnosis.story.watermark']}"
                                         id="caseHistoryInput" style="width:90%"
                                         onclick="PF('caseHistoryOverlay').showAndFocus('#{component.clientId}', submitCustomCaseHistory)"
                                         onkeypress="PF('caseHistoryOverlay').hide();">
                            <p:ajax event="change"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.caseHistory',receiptLogView.task.caseHistory)}"> </p:ajax>
                        </p:inputTextarea>

                        <hm:caseHistorySelectOverlay id="caseHistoryOverlay" widgetVar="caseHistoryOverlay"
                                                     source="#{receiptLogView.caseHistory}">
                            <p:ajax event="rowSelect" update="contentForm:caseHistoryInput"
                                    process="contentForm:caseHistoryOverlay:content"
                                    partialSubmit="true"
                                    listener="#{receiptLogView.updateCaseHistoryWithName(receiptLogView.task, receiptLogView.caseHistory.selectedItem.value,'log.task.edit.caseHistory',receiptLogView.caseHistory.selectedItem.value)}"
                                    oncomplete="PF('caseHistoryOverlay').hide();"/>
                        </hm:caseHistorySelectOverlay>

                        <p:remoteCommand name="submitCustomCaseHistory"
                                         update="contentForm:caseHistoryInput"
                                         process="@this contentForm:caseHistoryOverlay:content"
                                         partialSubmit="true"
                                         actionListener="#{receiptLogView.updateCaseHistoryWithName(receiptLogView.task, receiptLogView.caseHistory.filter,'log.task.edit.caseHistory',receiptLogView.caseHistory.filter)}"
                                         oncomplete="PF('caseHistoryOverlay').hide();">
                        </p:remoteCommand>
                    </div>
                    <!-- ##################### commentary ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.receiptlog.commentary']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:inputTextarea styleClass="customBackground"
                                         disabled="#{!receiptLogView.task.taskStatus.editable}"
                                         value="#{receiptLogView.task.commentary}"
                                         style="width:90%">
                            <p:ajax event="change"
                                    listener="#{receiptLogView.save(receiptLogView.task, 'log.task.edit.commentary',receiptLogView.task.commentary)}"/>
                        </p:inputTextarea>
                    </div>
                </div>
            </div>
            <div class="ui-g-4">
                <div class="ui-g ui-g-nopad">
                    <!-- ##################### Task Number ##################### -->
                    <div class="ui-g-12 ui-md-6 ui-lg-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.taskNumber']}"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-4 ui-g-vCenter">
                        <p:inputText disabled="true"
                                     value="#{receiptLogView.task.taskID}"/>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-4 ui-g-vCenter">
                        <p:commandLink title="#{msg['body.diagnosis.taskNumber.change']}"
                                       rendered="#{userService.userHasPermission('TASK_EDIT_ID')}"
                                       disabled="#{!receiptLogView.task.taskStatus.editable}"
                                       actionListener="#{dialog.changeTaskIDDialog.initAndPrepareBean(worklistHandler.current.selectedTask)}">
                            <i class="fa fa-fw fa-cog"/>
                            <p:ajax event="dialogReturn"
                                    listener="#{dialogReturnHandler.onDefaultReturn}"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                    </div>
                    <!-- ##################### material ##################### -->
                    <div class="ui-g-12">
                        <p:outputLabel value="#{msg['body.receiptlog.material']}"
                                       styleClass="bigFont"/>
                    </div>
                    <div class="ui-g-12">
                        <hm:materialSelectComponent editable="#{receiptLogView.task.taskStatus.editable}"
                                                    source="#{receiptLogView}"
                                                    widgetVar="materialComponent" id="materialComponent"/>
                    </div>
                </div>
            </div>
            <div class="ui-g-4">
                <!-- ##################### contacts ##################### -->
                <div class="ui-g ui-g-nopad">
                    <div class="ui-g-10">
                        <h:outputLabel value="#{msg['body.receiptlog.notification']}"
                                       styleClass="bigFont"/>
                    </div>
                    <div class="ui-g-2">

                        <div class="ui-g ui-g-nopad">
                            <!-- ##################### quickContact surgeon ##################### -->
                            <div class="ui-g-4">
                                <p:commandLink
                                        onclick="PF('surgeonOverlay').showAndFocus('#{component.clientId}')"
                                        title="#{msg['body.receiptlog.notification.surgeon.hint']}"
                                        partialSubmit="@this"
                                        process="@this"
                                        disabled="#{!receiptLogView.task.taskStatus.editable}">
                                    <i class="fa fa-fw fa-scissors"/>
                                </p:commandLink>

                                <hm:physicianSelectOverlay source="#{receiptLogView.surgeons}"
                                                           widgetVar="surgeonOverlay"
                                                           id="surgeonOverlay">
                                    <p:ajax event="rowSelect"
                                            partialSubmit="true"
                                            update="contentForm:contentPanel"
                                            process="@this contentForm:surgeonOverlay:content"
                                            listener="#{receiptLogView.surgeons.onSelect()}"
                                            oncomplete="PF('surgeonOverlay').hide();"/>
                                </hm:physicianSelectOverlay>
                            </div>
                            <div class="ui-g-4">
                                <!-- ##################### quickcontact private physician ##################### -->
                                <p:commandLink
                                        onclick="PF('privatePhysicianOverlay').showAndFocus('#{component.clientId}')"
                                        title="#{msg['body.receiptlog.notification.ophthalmologist.hint']}"
                                        disabled="#{!receiptLogView.task.taskStatus.editable}">
                                    <i class="fa fa-fw fa-eye"/>
                                </p:commandLink>

                                <!-- private physician overlay panel -->
                                <hm:physicianSelectOverlay source="#{receiptLogView.privatePhysician}"
                                                           widgetVar="privatePhysicianOverlay"
                                                           id="privatePhysicianOverlay">
                                    <p:ajax event="rowSelect"
                                            partialSubmit="true"
                                            update="contentForm:contentPanel"
                                            process="@this contentForm:privatePhysicianOverlay:content"
                                            listener="#{receiptLogView.privatePhysician.onSelect()}"
                                            oncomplete="PF('privatePhysicianOverlay').hide();"/>
                                </hm:physicianSelectOverlay>
                            </div>
                            <div class="ui-g-4">
                                <!-- ##################### edit contacts ##################### -->
                                <p:commandLink title="#{msg['body.receiptlog.notification.hint']}"
                                               disabled="#{!receiptLogView.task.taskStatus.editable}"
                                               actionListener="#{contactDialog.initAndPrepareBean(receiptLogView.task)}">
                                    <i class="fa fa-fw fa-cog"/>
                                    <p:ajax event="dialogReturn"
                                            listener="#{dialogReturnHandler.onDefaultReturn}"
                                            update="navigationForm:patientList contentForm:contentPanel"/>
                                </p:commandLink>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <!-- contacts -->
                        <p:dataTable var="reportIntentStatus" scrollable="true" scrollHeight="90"
                                     style="width:450px" styleClass="defaultHistoDataTable"
                                     value="#{receiptLogView.reportNotificationIntentStatus.reportIntents}">

                            <!-- name -->
                            <p:column style="width:auto">
                                <f:facet name="header">
                                    <h:outputLabel value="#{msg['body.receiptlog.contact.name']}"/>
                                </f:facet>

                                <h:outputLabel value="#{reportIntentStatus.reportIntent.person.getFullName()}"
                                               id="test123"/>

                                <p:commandLink
                                        styleClass="contactInfoOverplayTrigger"
                                        icon="pi pi-search"
                                        actionListener="#{receiptLogView.setSelectedReportIntentStatus(reportIntentStatus)}"
                                        partialSubmit="true"
                                        process="@this"
                                        update="contentForm:contactInfoOverlayBearer:contactInfoOverlayPanel"
                                        oncomplete="commonFunctions.showOverlayPanel('contactInfoOverlayPanel', '#{component.clientId}');">
                                    <i class="fa fa-info-circle"/>
                                </p:commandLink>
                            </p:column>

                            <!-- role-->
                            <p:column style="width: 20%;">
                                <f:facet name="header">
                                    <h:outputLabel value="#{msg['body.receiptlog.contact.role']}"/>
                                </f:facet>
                                <h:outputLabel
                                        value="#{msg['enum.contactRole.'.concat(reportIntentStatus.reportIntent.role)]}"
                                        title="#{msg['enum.contactRole.'.concat(reportIntentStatus.reportIntent.role)]}">
                                    <f:converter converterId="org.histo.ui.TruncateConverter"/>
                                    <f:attribute name="truncateAt" value="13"/>
                                    <f:attribute name="continuationMark" value="..."/>
                                </h:outputLabel>
                            </p:column>

                            <!-- city -->
                            <p:column style="width: 20%;">
                                <f:facet name="header">
                                    <h:outputLabel value="#{msg['body.receiptlog.contact.location']}"/>
                                </f:facet>

                                <h:outputLabel
                                        value="#{reportIntentStatus.reportIntent.person.contact.town}"
                                        title="#{reportIntentStatus.reportIntent.person.contact.town}">
                                    <f:converter converterId="org.histo.ui.TruncateConverter"/>
                                    <f:attribute name="truncateAt" value="15"/>
                                    <f:attribute name="continuationMark" value="..."/>
                                </h:outputLabel>
                            </p:column>

                            <!-- completed -->
                            <p:column style="width:15px">
                                <f:facet name="header">
                                    <i class="fa fa-check-square-o"
                                       title="#{msg['body.receiptlog.contact.type.performed']}"/>
                                </f:facet>
                                <ui:fragment rendered="#{reportIntentStatus.completed}">
                                    <i class="fa fa-check icon-green"/>
                                </ui:fragment>
                            </p:column>
                        </p:dataTable>

                        <!-- overlay for report intent information -->
                        <histo:OverlayNotificationStatusForReportIntent id="contactInfoOverlayBearer"
                                                                        reportIntentStatus="#{receiptLogView.selectedReportIntentStatus}"
                                                                        wid="contactInfoOverlayPanel"
                                                                        triggerClass="contactInfoOverplayTrigger"/>
                    </div>
                </div>
            </div>
        </div>

        <!-- slide list -->
        <h:panelGrid columns="1" styleClass="defaultHistoTable">
            <!-- healinse -->
            <h:panelGroup>
                <h:outputLabel value="#{msg['body.receiptlog.slide.name']}" styleClass="bigFont"/>
                <!-- staining completed -->
                <h:panelGroup
                        rendered="#{!receiptLogView.task.taskStatus.listStatus.inListStaining and !receiptLogView.task.taskStatus.listStatus.inListReStaining}">
                    <div class="fa fa-check-circle icon-green" title="#{msg['body.receiptlog.slide.completed']}"/>
                </h:panelGroup>
                <!-- staining to perform -->
                <h:panelGroup
                        rendered="#{receiptLogView.task.taskStatus.listStatus.inListStaining}">
                    <div class="fa fa-exclamation-circle icon-orange" title="#{msg['body.receiptlog.slide.staining']}"/>
                </h:panelGroup>
                <!-- restaining to perform -->
                <h:panelGroup
                        rendered="#{receiptLogView.task.taskStatus.listStatus.inListReStaining}">
                    <div class="fa fa-exclamation-circle ic-custom icon-orange"
                         title="#{msg['body.receiptlog.slide.restaining']}"/>
                </h:panelGroup>
            </h:panelGroup>

            <!-- data -->
            <p:dataTable var="stainingRow"
                         styleClass="noBackgroundHistoDataTable"
                         value="#{receiptLogView.rows}"
                         rowIndexVar="index">

                <!-- sample -->
                <p:column style="width: 12%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}"
                          headerText="#{msg['body.receiptlog.slide.headline.sample']}">

                    <h:panelGroup rendered="#{stainingRow.sampleType}">
                        <h:panelGroup layout="block" style="width: 90%; min-height:20px">
                            <p:commandLink process="@this" update="contentForm:contentPanel"
                                           styleClass="updateName_js_Class"
                                           oncomplete="commonFunctions.showAndUpdateOverlayPanel('idInputPannel', '#{component.clientId}' ,null, null, 'contentForm:idInputPannelInput', null);">

                                <h:outputLabel styleClass="doNotHideOverlay_js_Class"
                                               value="#{msg['body.receiptlog.slide.sample']} #{stainingRow.IDText}"/>

                                <h:panelGroup rendered="#{stainingRow.entity.idManuallyAltered}">
                                    <i class="fa fa-fw fa-chain doNotHideOverlay_js_Class"
                                       title="#{msg['body.statiningView.idManuallyAltered']}"/>
                                </h:panelGroup>

                                <!-- saving if overlay panel is already shown and something was changed -->
                                <f:ajax
                                        listener="#{receiptLogView.entityNameChange(receiptLogView.selectedRow, 'log.task.edit.idManuallyAltered', receiptLogView.selectedRow.entity.toString())}"/>

                                <!-- showing panel with new data -->
                                <f:ajax
                                        listener="#{receiptLogView.setSelectedRow(stainingRow)}"/>

                            </p:commandLink>
                        </h:panelGroup>
                    </h:panelGroup>

                </p:column>

                <!-- Block -->
                <p:column style="width: 12%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}"
                          headerText="#{msg['body.receiptlog.slide.headline.block']}">

                    <h:panelGroup rendered="#{stainingRow.blockType}">
                        <h:panelGroup layout="block" style="width: 90%; min-height:20px">
                            <p:commandLink process="@this" update="contentForm:contentPanel"
                                           styleClass="updateName_js_Class"
                                           oncomplete="commonFunctions.showAndUpdateOverlayPanel('idInputPannel', '#{component.clientId}' ,null, null, 'contentForm:idInputPannelInput', null);">
                                <h:outputLabel styleClass="doNotHideOverlay_js_Class"
                                               value="#{msg['body.receiptlog.slide.block']} #{stainingRow.IDText}"/>
                                <h:panelGroup rendered="#{stainingRow.entity.idManuallyAltered}">
                                    <i class="fa fa-fw fa-chain doNotHideOverlay_js_Class"
                                       title="#{msg['body.statiningView.idManuallyAltered']}"/>
                                </h:panelGroup>

                                <!-- saving if overlay panel is already shown and something was changed -->
                                <f:ajax
                                        listener="#{receiptLogView.entityNameChange(receiptLogView.selectedRow, 'log.task.edit.idManuallyAltered', receiptLogView.selectedRow.entity.toString())}"/>
                                <!-- showing panel with new data -->
                                <f:ajax
                                        listener="#{receiptLogView.setSelectedRow(stainingRow)}"/>
                            </p:commandLink>

                        </h:panelGroup>

                    </h:panelGroup>
                </p:column>

                <!-- Staining chooser -->
                <p:column style="width: 3%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}"
                          headerText="">

                    <h:panelGroup
                            rendered="#{stainingRow.sampleType or stainingRow.blockType}">
                        <p:commandLink
                                actionListener="#{receiptLogView.toggleSelectoin(stainingRow)}"
                                update="contentForm:contentPanel"
                                title="#{stainingRow.sampleType ? msg['body.statiningView.chooseSample'] : msg['body.statiningView.chooseBlock']}">
                            <i class="fa fa-fw fa-check-circle"/>
                        </p:commandLink>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{stainingRow.stainingType}">
                        <p:selectBooleanCheckbox value="#{stainingRow.selected}"/>
                    </h:panelGroup>

                </p:column>

                <!-- staining - name -->
                <p:column style="width: 19%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}"
                          headerText="#{msg['body.receiptlog.slide.headline.staining.id']}">

                    <h:panelGroup rendered="#{stainingRow.stainingType}">
                        <h:panelGroup layout="block" style="width: 90%; min-height:20px">

                            <p:commandLink process="@this" update="contentForm:contentPanel"
                                           styleClass="updateName_js_Class"
                                           oncomplete="commonFunctions.showAndUpdateOverlayPanel('idInputPannel', '#{component.clientId}' ,null, null, 'contentForm:idInputPannelInput', null);">

                                <h:outputLabel value="#{stainingRow.IDText}"
                                               styleClass="doNotHideOverlay_js_Class"/>

                                <h:panelGroup rendered="#{stainingRow.entity.idManuallyAltered}">
                                    <i class="fa fa-fw fa-chain doNotHideOverlay_js_Class"
                                       title="#{msg['body.statiningView.idManuallyAltered']}"/>
                                </h:panelGroup>

                                <!-- saving if overlay panel is already shown and something was changed -->
                                <f:ajax
                                        listener="#{receiptLogView.entityNameChange(receiptLogView.selectedRow, 'log.task.edit.idManuallyAltered', stainingRow.entity.toString())}"/>
                                <!-- showing panel with new data -->
                                <f:ajax
                                        listener="#{receiptLogView.setSelectedRow(stainingRow)}"/>
                            </p:commandLink>

                        </h:panelGroup>
                    </h:panelGroup>

                </p:column>

                <!-- staining slide text -->
                <p:column style="width: auto;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}"
                          headerText="#{msg['body.receiptlog.slide.headline.staining.slideLabelText']}">

                    <h:panelGroup rendered="#{stainingRow.stainingType}">

                        <p:selectOneMenu style="width: 90%"
                                         value="#{stainingRow.entity.slideLabelText}" editable="true"
                                         disabled="#{!receiptLogView.task.taskStatus.editable or stainingRow.entity.stainingCompleted}">

                            <f:selectItems
                                    value="#{genericViewData.slideCommentary}"
                                    var="slideLabelText" itemLabel="#{slideLabelText.value}"
                                    itemValue="#{slideLabelText.value}"/>

                            <p:ajax event="change" execute="@this"
                                    listener="#{receiptLogView.save(stainingRow.entity.task, 'log.slide.edit.textUpdate',stainingRow.entity, stainingRow.IDText)}"/>
                        </p:selectOneMenu>

                    </h:panelGroup>
                </p:column>

                <!-- commentary -->
                <p:column style="width: 4%"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''} centerChildElements"
                          headerText="#{msg['body.receiptlog.slide.headline.staining.commentary']}">
                    <h:panelGroup
                            rendered="#{stainingRow.stainingType and not empty stainingRow.entity.commentary}">
                        <i class="fa fa-fw fa-exclamation-triangle icon-red"
                           title="#{stainingRow.entity.commentary}"/>
                    </h:panelGroup>
                </p:column>

                <!-- Staining staining -->
                <p:column style="width: 8%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}"
                          headerText="#{msg['body.receiptlog.slide.headline.staining.staining']}">

                    <h:panelGroup rendered="#{stainingRow.stainingType}">
                        <h:outputText value="#{stainingRow.entity.slidePrototype.name}"/>
                    </h:panelGroup>

                </p:column>

                <!-- Staining status -->
                <p:column style="width: 5%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''} centerChildElements">

                    <!-- Sample status -->
                    <h:panelGroup rendered="#{stainingRow.sampleType}">
                        <!-- ********** Staining performed ********** -->
                        <h:panelGroup
                                rendered="#{receiptLogView.task.taskStatus.checkIfStainingCompleted(stainingRow.entity)}">
                            <i class="fa fa-fw fa-check-circle icon-green"
                               title="#{msg['body.statiningView.status.performed']}"/>
                        </h:panelGroup>
                    </h:panelGroup>

                    <!-- Block status -->
                    <h:panelGroup rendered="#{stainingRow.blockType}">
                        <!-- ********** Staining performed ********** -->
                        <h:panelGroup
                                rendered="#{receiptLogView.task.taskStatus.checkIfStainingCompleted(stainingRow.entity)}">
                            <i class="fa fa-fw fa-check-circle icon-green"
                               title="#{msg['body.statiningView.status.performed']}"/>
                        </h:panelGroup>
                    </h:panelGroup>

                    <!-- Slide status -->
                    <h:panelGroup rendered="#{stainingRow.stainingType}">
                        <!-- ********** Staining performed ********** -->
                        <h:panelGroup rendered="#{stainingRow.entity.stainingCompleted}">
                            <i class="fa fa-fw fa-check-circle icon-green"
                               title="#{msg['body.statiningView.status.performed']}"/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{stainingRow.entity.reStaining}">
                            <i class="fa fa-fw fa-th-list icon-orange"
                               title="#{msg['body.statiningView.status.restaining']}"/>
                        </h:panelGroup>
                    </h:panelGroup>
                </p:column>

                <!-- Options -->
                <p:column style="width: 11%;"
                          styleClass="#{stainingRow.even ? 'manual-column-color' : ''}">

                    <f:facet name="header">
                        <h:outputLabel
                                value="#{msg['body.receiptlog.slide.headline.options']}"/>
                        <p:commandLink id="quickTaskSettings"
                                       actionListener="#{dialog.slideNamingDialog.initAndPrepareBean(receiptLogView.task)}">
                            <i class="fa fa-wrench" style="float: right; margin-right: 5px"
                               title="#{msg['body.receiptlog.slide.headline.options.text']}"/>
                            <p:ajax event="dialogReturn"
                                    listener="#{dialogReturnHandler.onDefaultReturn}"
                                    update="navigationForm:patientList contentForm:contentPanel"/>
                        </p:commandLink>
                    </f:facet>

                    <!-- Sample -->
                    <h:panelGroup rendered="#{stainingRow.sampleType}"
                                  style="float: right">
                        <!-- ********** New Block Button ********** -->
                        <p:commandLink title="#{msg['body.statiningView.newBlock']}"
                                       disabled="#{!receiptLogView.task.taskStatus.editable}"
                                       update="navigationForm:patientList contentForm:contentPanel headerForm"
                                       actionListener="#{receiptLogView.createNewBlock(stainingRow.entity)}">
                            <i class="fa fa-fw fa-stop"/>
                        </p:commandLink>
                        <!-- ********** Delete Button ********** -->
                        <p:commandLink title="#{msg['body.statiningView.archiveSample']}"
                                       disabled="#{!receiptLogView.task.taskStatus.editable}"
                                       actionListener="#{deleteTaskEntityDialog.initAndPrepareBean(stainingRow.entity).advancedHeader('dialog.delete.sample.text',stainingRow.entity.sampleID).advancedText('dialog.delete.sample.text',stainingRow.entity.sampleID)}">
                            <i class="fa fa-fw fa-times-circle"/>
                            <p:ajax event="dialogReturn"
                                    listener="#{dialogReturnHandler.onDeleteTaskEntityReturn}"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                    </h:panelGroup>

                    <!-- Block -->
                    <h:panelGroup rendered="#{stainingRow.blockType}"
                                  style="float: right">
                        <!-- ********** New slide Button ********** -->
                        <h:panelGroup>
                            <p:commandLink title="#{msg['body.statiningView.newStaining']}"
                                           disabled="#{!receiptLogView.task.taskStatus.editable}"
                                           actionListener="#{dialog.addSlidesDialog.initAndPrepareBean(stainingRow.entity)}">
                                <i class="fa fa-fw fa-paint-brush"/>
                                <p:ajax event="dialogReturn"
                                        update="navigationForm:patientList contentForm:contentPanel headerForm"
                                        listener="#{dialogReturnHandler.onStainingPhaseUpdateReturn}"
                                />
                            </p:commandLink>
                        </h:panelGroup>
                        <!-- ********** Delete Button ********** -->
                        <p:commandLink
                                disabled="#{!receiptLogView.task.taskStatus.editable}"
                                title="#{msg['body.statiningView.archiveBlock']}"
                                actionListener="#{deleteTaskEntityDialog.initAndPrepareBean(stainingRow.entity).advancedHeader('dialog.delete.block.headline',stainingRow.entity.blockID).advancedText('dialog.delete.block.text',stainingRow.entity.blockID)}">
                            <i class="fa fa-fw fa-times-circle"/>
                            <p:ajax event="dialogReturn"
                                    listener="#{dialogReturnHandler.onDeleteTaskEntityReturn}"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                    </h:panelGroup>

                    <!-- Staining -->
                    <h:panelGroup rendered="#{stainingRow.stainingType}"
                                  style="float: right">
                        <!-- ********** Print Button ********** -->
                        <p:commandLink
                                actionListener="#{receiptLogView.printLabels(stainingRow.entity)}"
                                title="#{msg['body.statiningView.printStaining']}">
                            <i class="fa fa-fw fa-print"/>
                            <p:ajax event="dialogReturn"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                        <!-- complete Button -->
                        <p:commandLink
                                actionListener="#{receiptLogView.completeSlide(stainingRow.entity,true)}"
                                title="#{msg['body.statiningView.stainingCompleted']}"
                                update="navigationForm:patientList contentForm:contentPanel headerForm">
                            <i class="fa fa-fw fa-check-circle"/>
                        </p:commandLink>
                        <!-- ********** Cloud Button ********** -->
                        <p:commandLink title="#{msg['body.statiningView.showStaining']}"
                                       disabled="true">
                            <i class="fa fa-fw fa-file-photo-o"/>
                            <p:ajax event="dialogReturn"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                        <!-- ********** Delete Button ********** -->
                        <p:commandLink
                                disabled="#{!receiptLogView.task.taskStatus.editable}"
                                title="#{msg['body.statiningView.archiveStaining']}"
                                actionListener="#{deleteTaskEntityDialog.initAndPrepareBean(stainingRow.entity).advancedHeader('dialog.delete.slide.headline',stainingRow.entity.slideID).advancedText('dialog.delete.slide.text',stainingRow.entity.slideID)}">
                            <i class="fa fa-fw fa-times-circle"/>
                            <p:ajax event="dialogReturn"
                                    listener="#{dialogReturnHandler.onDeleteTaskEntityReturn}"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                    </h:panelGroup>
                </p:column>
            </p:dataTable>

            <script type="text/javascript">
                commonFunctions.addGlobalHideOverlayPanelOnMouseClickHandler('idInputPannel')
            </script>

            <!-- overlaypannel for editing sample/block/slide name -->
            <p:overlayPanel id="idInputPannel" onHide="saveNameChange()"
                            dismissable="false" styleClass="histoOverlayPanel"
                            widgetVar="idInputPannel" hideEvent="null" showEvent="null">

                <p:inputText id="idInputPannelInput" widgetVar="idInputPannelInput"
                             styleClass="doNotHideOverlay_js_Class"
                             onkeypress="return closeOverlayPanelOnReturn(event, 'idInputPannel')"
                             disabled="#{!receiptLogView.task.taskStatus.editable}"
                             rendered="#{receiptLogView.selectedRow ne null}"
                             value="#{receiptLogView.selectedRow.IDText}">
                    <p:ajax event="change" process="@this"/>
                </p:inputText>
            </p:overlayPanel>

            <p:remoteCommand
                    actionListener="#{receiptLogView.entityNameChange(receiptLogView.selectedRow, 'log.task.edit.idManuallyAltered', stainingRow.entity.toString())}"
                    name="saveNameChange" update="@(.updateName_js_Class)"/>

        </h:panelGrid>

        <!-- bottom buttons -->
        <h:panelGrid columns="6"
                     style="margin-top:10px; width:auto !important"
                     styleClass="defaultHistoTable">

            <!-- end staning phase -->
            <p:commandButton
                    value="#{msg['body.statiningView.stainingPhaseEnd']}"
                    icon="fa fa-fw fa-image"
                    disabled="#{!receiptLogView.task.taskStatus.editable}"
                    actionListener="#{stainingPhaseExitDialog.initAndPrepareBean(receiptLogView.task)}">
                <p:ajax event="dialogReturn"
                        listener="#{dialogReturnHandler.onDefaultReturn}"
                        update="navigationForm:patientList contentForm:contentPanel headerForm"/>
            </p:commandButton>

            <!-- New sample -->
            <p:commandButton icon="fa fa-fw fa-plus-circle"
                             disabled="#{!receiptLogView.task.taskStatus.editable}"
                             value="#{msg['body.statiningView.newSample']}"
                             actionListener="#{dialog.createSampleDialog.initAndPrepareBean(receiptLogView.task)}">
                <p:ajax event="dialogReturn"
                        listener="#{dialogReturnHandler.onStainingPhaseUpdateReturn}"
                        update="navigationForm:patientList contentForm:contentPanel"/>
            </p:commandButton>

            <!-- Print all slides -->
            <p:commandButton icon="fa fa-fw fa-print"
                             value="#{msg['body.statiningView.printAll']}"
                             actionListener="#{receiptLogView.printAllLabels()}">
            </p:commandButton>

            <!-- select all -->
            <p:commandButton icon="fa fa-fw fa-check-circle"
                             disabled="#{!receiptLogView.task.taskStatus.editable}"
                             update="contentForm:contentPanel"
                             value="#{msg['body.statiningView.chooseAll']}"
                             actionListener="#{receiptLogView.selectListChildren(receiptLogView.rows,true)}"/>

            <h:outputLabel value="#{msg['body.statiningView.choosenElements']}"
                           style="margin-left:20px;"/>

            <h:panelGroup>
                <p:selectOneMenu
                        value="#{receiptLogView.actionOnMany}"
                        disabled="#{!receiptLogView.task.taskStatus.editable}"
                        onchange="PF('performOnMay').jq.click();">

                    <f:selectItems value="#{enumProvider.stainingListActions}"
                                   var="action"
                                   itemLabel="#{msg['enum.stainingListAction.'.concat(action)]}"/>

                </p:selectOneMenu>

                <p:commandButton id="changeZone" widgetVar="performOnMay"
                                 style="display:none;"
                                 update="navigationForm:patientList contentForm:contentPanel headerForm"
                                 actionListener="#{receiptLogView.performActionOnSelectedSlides(receiptLogView.actionOnMany)}">
                </p:commandButton>

            </h:panelGroup>
        </h:panelGrid>
    </p:panel>
</ui:composition>
