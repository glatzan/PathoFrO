<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:hm="http://java.sun.com/jsf/composite/components/miscellaneous"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:outputScript library="scripts" name="closeOverlayPanelOnReturn.js"/>

    <ui:include src="include/navigationBar.xhtml"/>

    <p:panel style="width: 80%"
             styleClass="defaultHistoHiddenTableContainer">

        <h:outputLabel value="#{msg['body.diagnosis.headline']}"
                       style="font-size:1.5em;"/>

        <div class="ui-g ui-g-nopad">
            <div class="ui-g-5">
                <!-- ##################### material ##################### -->
                <hm:materialSelectComponent editable="#{diagnosisView.task.taskStatus.editable}"
                                            source="#{diagnosisView}"
                                            widgetVar="materialComponent" id="materialComponent"/>

                <div class="ui-g ui-g-nopad">
                    <!-- ##################### Eye ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.eye']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:selectOneMenu styleClass="customBackground" tabindex="6"
                                         style="background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor}"
                                         disabled="#{!diagnosisView.task.taskStatus.editable}"
                                         value="#{diagnosisView.task.eye}">

                            <f:selectItems value="#{enumProvider.eyes}" var="eye"
                                           itemLabel="#{msg['enum.eye.'.concat(eye)]}" itemValue="#{eye}"/>

                            <p:ajax event="change" execute="@this"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.eye',diagnosisView.task.eye)}"/>
                        </p:selectOneMenu>
                    </div>

                    <!-- ##################### history ##################### -->
                    <div class="ui-g-12">
                        <h:outputLabel value="#{msg['body.diagnosis.story']}"/>
                    </div>
                    <div class="ui-g-12">
                        <hm:caseHistorySelectComponent widgetVar="caseHistoryComponent" id="caseHistoryComponent"
                                                       source="#{diagnosisView}"
                                                       editable="#{diagnosisView.task.taskStatus.editable}"/>
                    </div>
                </div>
            </div>
            <div class="ui-g-1"></div>
            <div class="ui-g-6">
                <div class="ui-g ui-g-nopad">
                    <!-- ##################### Task Number ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.taskNumber']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:inputText disabled="true"
                                     value="#{diagnosisView.task.taskID}"/>
                        <p:commandLink title="#{msg['body.diagnosis.taskNumber.change']}"
                                       rendered="#{userService.userHasPermission('TASK_EDIT_ID')}"
                                       disabled="#{!diagnosisView.task.taskStatus.editable}"
                                       actionListener="#{dialog.changeTaskIDDialog.initAndPrepareBean(worklistHandler.current.selectedTask)}">
                            <i class="fa fa-fw fa-cog"/>
                            <p:ajax event="dialogReturn"
                                    listener="#{dialogReturnHandler.onDefaultReturn}"
                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>
                        </p:commandLink>
                    </div>

                    <!-- ##################### date of surgery #####################  -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.surgeryDate']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:calendar pattern="dd.MM.yyyy" mask="true" tabindex="2" converter="localDateConverter"
                                    style="background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor}"
                                    styleClass="customBackground"
                                    disabled="#{!diagnosisView.task.taskStatus.editable}"
                                    value="#{diagnosisView.task.dateOfSugery}">
                            <p:ajax event="dateSelect"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.dateOfSurgerye',diagnosisView.task.dateOfSugery)}"/>
                            <f:ajax event="change" execute="@this"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.dateOfSurgerye',diagnosisView.task.dateOfSugery)}"/>
                        </p:calendar>
                    </div>

                    <!-- ##################### date of receipt #####################  -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.taskEDate']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:calendar pattern="dd.MM.yyyy" mask="true" tabindex="3" converter="localDateConverter"
                                    disabled="#{!diagnosisView.task.taskStatus.editable}"
                                    style="background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor}"
                                    styleClass="customBackground"
                                    value="#{diagnosisView.task.receiptDate}">
                            <p:ajax event="dateSelect" process="@this"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.receiptDate',diagnosisView.task.receiptDate)}"/>
                            <f:ajax event="change" execute="@this"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.receiptDate',diagnosisView.task.receiptDate)}"/>
                        </p:calendar>
                    </div>

                    <!-- ##################### insurance ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.insurance']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:inputText
                                disabled="#{!diagnosisView.task.taskStatus.editable}"
                                value="#{diagnosisView.task.insurance}">
                            <p:ajax event="change" execute="@this"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.insurance',diagnosisView.task.insurance)}"/>
                        </p:inputText>
                    </div>

                    <!-- ##################### ward ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.ward']}"/>
                    </div>
                    <div class="ui-g-8">
                        <p:selectOneMenu id="wards"
                                         value="#{diagnosisView.task.ward}"
                                         editable="true"
                                         disabled="#{!diagnosisView.task.taskStatus.editable}"
                                         styleClass="customBackground" tabindex="5"
                                         style="background:##{userService.currentUser.settings.inputFieldColor};color:##{userService.currentUser.settings.inputFieldFontColor}">

                            <f:selectItems
                                    value="#{genericViewData.wardList}"
                                    itemValue="#{ward.value}" itemLabel="#{ward.value}" var="ward"/>
                            <p:ajax event="change" execute="@this"
                                    listener="#{diagnosisView.save(diagnosisView.task, 'log.task.edit.ward',diagnosisView.task.ward)}"/>
                        </p:selectOneMenu>
                    </div>

                    <!-- ##################### surgeon ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.surgeon']}"/>
                    </div>
                    <div class="ui-g-8">
                        <hm:physicianDisplayPrimaryComponent editable="#{diagnosisView.task.taskStatus.editable}"
                                                             otherContactsOfSameRole="#{diagnosisView.getContactsForRole('SURGEON', 'EXTERNAL_SURGEON')}"
                                                             widgetVar="primarySurgeon"
                                                             addIcon="fa-scissors"
                                                             primaryContact="#{diagnosisView.getPrimaryContactForRole('SURGEON', 'EXTERNAL_SURGEON').person}"
                                                             physicanSource="#{diagnosisView.surgeons}"/>
                    </div>

                    <!-- ##################### private physician ##################### -->
                    <div class="ui-g-4 ui-g-vCenter">
                        <h:outputLabel value="#{msg['body.diagnosis.privatePhysician']}"/>
                    </div>
                    <div class="ui-g-8">
                        <hm:physicianDisplayPrimaryComponent editable="#{diagnosisView.task.taskStatus.editable}"
                                                             otherContactsOfSameRole="#{diagnosisView.getContactsForRole('PRIVATE_PHYSICIAN')}"
                                                             widgetVar="privatePhysicians"
                                                             primaryContact="#{diagnosisView.getPrimaryContactForRole('PRIVATE_PHYSICIAN').person}"
                                                             physicanSource="#{diagnosisView.privatePhysician}"/>
                    </div>
                </div>
            </div>

            <!-- ##################### ##################### Diagnoses ##################### ##################### -->
            <ui:repeat value="#{diagnosisView.task.diagnosisRevisions}" var="revision" varStatus="revisionCounter">
                <!-- ##################### seperator ##################### -->
                <div class="ui-g-12">
                    <p:separator/>
                </div>
                <div class="ui-g-12">
                    <hm:diagosisRevisionEditComponent editable="#{diagnosisView.task.taskStatus.editable}"
                                                      widgetVar="diagnosis_#{revisionCounter.index}"
                                                      id="diagnosis_#{revisionCounter.index}"
                                                      diagnosisView="#{diagnosisView}"
                                                      diagnosisPresetData="#{diagnosisView.diagnoses}"
                                                      diagnosisRevison="#{revision}"
                                                      diagnosisRevisionEditable="#{true}"/>
                </div>
            </ui:repeat>
        </div>


        <!--        &lt;!&ndash; Diagnoses &ndash;&gt;-->
        <!--        <c:forEach-->
        <!--                items="#{diagnosisView.task.diagnosisRevisions}"-->
        <!--                varStatus="varCounterOuter" var="revision">-->

        <!--            &lt;!&ndash; spot light &ndash;&gt;-->
        <!--            <p:spotlight target="diagnosisSpotContent#{varCounterOuter.index}"-->
        <!--                         widgetVar="diagnosisSpotBlocker#{varCounterOuter.index}"/>-->

        <!--            <h:panelGrid id="diagnosisSpotContent#{varCounterOuter.index}"-->
        <!--                         styleClass="defaultHistoHiddenTableContainer" style="width:100%">-->

        <!--                <h:panelGrid columns="2" styleClass="defaultHistoTable"-->
        <!--                             id="diagnosisSpotDiagnosis#{varCounterOuter.index}"-->
        <!--                             columnClasses="columnWidth200 columnTop #{varCounterOuter.even ? '' : 'oddColumnColored' }, #{varCounterOuter.even ? '' : 'oddColumnColored'}">-->

        <!--                    &lt;!&ndash; Extended Diagnosis Text &ndash;&gt;-->
        <!--                    &lt;!&ndash; diagonsis name&ndash;&gt;-->
        <!--                    <h:panelGroup layout="block" id="pPannel"-->
        <!--                                  style="width: 90%; min-height:16px; #{revision.name == '' ? 'background: #fcf1b8' : ''}"-->
        <!--                                  onclick="PF('diagnosisNamePannel#{varCounterOuter.index}').show()">-->
        <!--                        <h:outputLabel value="#{revision.name}"/>-->

        <!--                        <p:overlayPanel id="diagnosisNamePannel#{varCounterOuter.index}"-->
        <!--                                        onHide="saveDiagnosisNameChange()" styleClass="histoOverlayPanel"-->
        <!--                                        widgetVar="diagnosisNamePannel#{varCounterOuter.index}"-->
        <!--                                        hideEffect="fade" hideEvent="none" showEvent="none">-->
        <!--                            <p:inputText id="nameInputPannelInput#{varCounterOuter.index}"-->
        <!--                                         onkeypress="return closeOverlayPanelOnReturn(event, 'diagnosisNamePannel#{varCounterOuter.index}')"-->
        <!--                                         disabled="#{!diagnosisView.task.taskStatus.editable}"-->
        <!--                                         value="#{revision.name}"/>-->
        <!--                        </p:overlayPanel>-->

        <!--                        <p:remoteCommand-->
        <!--                                actionListener="#{diagnosisView.save(revision.task, 'log.diagnosisRevision.edit.name',revision,revision.name)}"-->
        <!--                                name="saveDiagnosisNameChange"-->
        <!--                                update="navigationForm:patientList contentForm:contentPanel headerForm"/>-->

        <!--                    </h:panelGroup>-->

        <!--                    &lt;!&ndash; extende text input &ndash;&gt;-->
        <!--                    <h:panelGroup id="extendedTextParent">-->
        <!--                        <p:inputTextarea style="width:99%" id="extendedText" rows="15"-->
        <!--                                         onfocus="disabledEventPropagation(event);"-->
        <!--                                         disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                         value="#{revision.text}">-->
        <!--                            <p:ajax event="keyup" process="@this" delay="250"-->
        <!--                                    listener="#{diagnosisView.save(revision.task, 'log.diagnosisRevision.edit.histologicalRecord',revision,revision.text)}"/>-->
        <!--                        </p:inputTextarea>-->
        <!--                    </h:panelGroup>-->

        <!--                    &lt;!&ndash; Diagnosis for sample &ndash;&gt;-->
        <!--                    <c:forEach items="#{revision.diagnoses}"-->
        <!--                               varStatus="varCounterInner" var="diagnosis">-->

        <!--                        <c:choose>-->
        <!--                            <c:when test="#{varCounterInner.first}">-->
        <!--                                <h:outputLabel value="#{msg['body.diagnosis.diagnoses']}"/>-->
        <!--                            </c:when>-->
        <!--                            <c:otherwise>-->
        <!--                                <h:outputLabel value=""/>-->
        <!--                            </c:otherwise>-->
        <!--                        </c:choose>-->

        <!--                        <h:panelGroup>-->
        <!--                            &lt;!&ndash; sample &ndash;&gt;-->
        <!--                            <c:choose>-->
        <!--                                <c:when test="#{revision.diagnoses.size() ne 1}">-->
        <!--                                    <h:outputLabel-->
        <!--                                            value="#{msg['body.diagnosis.sample']} #{diagnosis.sample.sampleID}"/>-->
        <!--                                </c:when>-->
        <!--                                <c:otherwise>-->
        <!--                                    <h:outputLabel value=""/>-->
        <!--                                </c:otherwise>-->
        <!--                            </c:choose>-->
        <!--                            <h:panelGroup>-->
        <!--                                &lt;!&ndash; copy diagnosis text &ndash;&gt;-->
        <!--                                <p:commandLink style="margin-left:20px;"-->
        <!--                                               disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision) or diagnosis.diagnosisPrototype.extendedDiagnosisText eq ''}"-->
        <!--                                               title="#{diagnosis.diagnosisPrototype.extendedDiagnosisText eq '' ? msg['body.diagnosis.histologicalRecordPreset.text.none'] : msg['body.diagnosis.histologicalRecordPreset.text']}"-->
        <!--                                               rendered="#{diagnosis.diagnosisPrototype ne null}"-->
        <!--                                               process="@this"-->
        <!--                                               actionListener="#{diagnosisView.setSelectedDiagnosis(diagnosis)}"-->
        <!--                                               oncomplete="copyHistologicalRecordCommand()">-->
        <!--                                    <i class="fa fa-copy"/>-->
        <!--                                </p:commandLink>-->
        <!--                                &lt;!&ndash; commandlink will set the selected diagnosis, this will call the function &ndash;&gt;-->
        <!--                                <p:remoteCommand-->
        <!--                                        actionListener="#{diagnosisView.copyHistologicalRecord(diagnosisView.selectedDiagnosis)}"-->
        <!--                                        update="contentForm:contentPanel" name="copyHistologicalRecordCommand"/>-->
        <!--                            </h:panelGroup>-->
        <!--                            &lt;!&ndash; malign &ndash;&gt;-->
        <!--                            <h:panelGrid columns="2" style="float:right;margin-right:20px;">-->
        <!--                                <h:outputLabel value="#{msg['body.diagnosis.malign']}"/>-->
        <!--                                <p:selectBooleanCheckbox value="#{diagnosis.malign}"-->
        <!--                                                         disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                                         style="margin:3px 0px 0px 3px;">-->
        <!--                                    <f:ajax event="change"-->
        <!--                                            listener="#{diagnosisView.save(diagnosis.task, 'log.diagnosis.edit.malign',diagnosis,diagnosis.malign)}"/>-->
        <!--                                </p:selectBooleanCheckbox>-->
        <!--                            </h:panelGrid>-->
        <!--                        </h:panelGroup>-->

        <!--                        <h:outputLabel/>-->
        <!--                        <h:panelGroup>-->
        <!--                            &lt;!&ndash; diagnosis text &ndash;&gt;-->
        <!--                            <p:inputTextarea value="#{diagnosis.diagnosis}"-->
        <!--                                             onkeypress="PF('diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}').hide();"-->
        <!--                                             onclick="commonFunctions.showAndUpdateOverlayPanel('diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}', '#{component.clientId}' , null, 'diagnosisOverlayPanelDataTable#{varCounterOuter.index}#{varCounterInner.index}', 'contentForm:diagnosisOverlayPanelDataTable#{varCounterOuter.index}#{varCounterInner.index}:diagnosisColumn:filter',submitNewCustomDiagnosis#{varCounterOuter.index}#{varCounterInner.index});"-->
        <!--                                             filterDelay="50"-->
        <!--                                             id="diagnosisText#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                             disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                             style="width:99%">-->
        <!--                                <p:watermark-->
        <!--                                        for="diagnosisText#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                        value="#{msg['body.receiptlog.tab.diangonsis.data.diangosis.watermark']}"/>-->
        <!--                                <f:ajax event="change" execute="@this"-->
        <!--                                        listener="#{diagnosisView.save(diagnosis.task, 'log.diagnosis.edit.diagnosisText',diagnosis,diagnosis.diagnosis)}"/>-->
        <!--                            </p:inputTextarea>-->

        <!--                            <p:overlayPanel-->
        <!--                                    widgetVar="diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                    id="diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                    styleClass="histoOverlayPanel" hideEffect="fade"-->
        <!--                                    style="width:500px" hideEvent="mousedown" showEvent="none">-->

        <!--                                <p:dataTable-->
        <!--                                        id="diagnosisOverlayPanelDataTable#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                        widgetVar="diagnosisOverlayPanelDataTable#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                        value="#{genericViewData.diagnosisPresets}"-->
        <!--                                        var="item" styleClass="defaultHistoDataTable" scrollable="true"-->
        <!--                                        scrollHeight="200" rowKey="#{item.id}"-->
        <!--                                        selection="#{diagnosisView.selectedDiagnosisPresets[varCounterOuter.index][varCounterInner.index]}"-->
        <!--                                        selectionMode="single">-->

        <!--                                    <p:column filterBy="#{item.diagnosis}" id="diagnosisColumn"-->
        <!--                                              filterValue="#{diagnosisView.diagnosisFilter[varCounterOuter.index][varCounterInner.index]}"-->
        <!--                                              filterMatchMode="contains">-->
        <!--                                        <h:outputText value="#{item.diagnosis}"/>-->
        <!--                                    </p:column>-->

        <!--                                    <p:ajax event="rowSelect"-->
        <!--                                            process="contentForm:diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                            partialSubmit="true"-->
        <!--                                            update="navigationForm:patientList contentForm:contentPanel headerForm"-->
        <!--                                            listener="#{diagnosisView.updateDiagnosisPrototype(diagnosis,diagnosisView.selectedDiagnosisPresets[varCounterOuter.index][varCounterInner.index])}"-->
        <!--                                            oncomplete="PF('diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}').hide();"/>-->

        <!--                                </p:dataTable>-->

        <!--                                <p:remoteCommand partialSubmit="true"-->
        <!--                                                 process="contentForm:diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                                 name="submitNewCustomDiagnosis#{varCounterOuter.index}#{varCounterInner.index}"-->
        <!--                                                 update="navigationForm:patientList contentForm:contentPanel headerForm"-->
        <!--                                                 actionListener="#{diagnosisView.updateDiagnosisPrototype(diagnosis,diagnosisView.diagnosisFilter[varCounterOuter.index][varCounterInner.index])}"-->
        <!--                                                 oncomplete="PF('diagnosisOverlayPanel#{varCounterOuter.index}#{varCounterInner.index}').hide();"/>-->

        <!--                            </p:overlayPanel>-->
        <!--                        </h:panelGroup>-->
        <!--                        &lt;!&ndash; Diagnosis for sample &ndash;&gt;-->
        <!--                    </c:forEach>-->

        <!--                </h:panelGrid>-->
        <!--                &lt;!&ndash; ****************************** Signature ****************************** &ndash;&gt;-->
        <!--                <h:panelGrid columns="6" styleClass="defaultHistoTable"-->
        <!--                             id="diagnosisSpotContentSignature#{varCounterOuter.index}"-->
        <!--                             columnClasses="columnLabelContainer200 columnTop #{varCounterOuter.even ? '' : 'oddColumnColored' }, #{varCounterOuter.even ? '' : 'oddColumnColored'}, #{varCounterOuter.even ? '' : 'oddColumnColored'}, #{varCounterOuter.even ? '' : 'oddColumnColored'}, #{varCounterOuter.even ? '' : 'oddColumnColored'}, #{varCounterOuter.even ? '' : 'oddColumnColored'}">-->

        <!--                    <h:outputLabel value="#{msg['body.diagnosis.signature.date']}"/>-->
        <!--                    <p:calendar pattern="dd.MM.yyyy" mask="true" converter="localDateConverter"-->
        <!--                                disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                value="#{revision.signatureDate}">-->
        <!--                        <p:ajax event="dateSelect"-->
        <!--                                listener="#{diagnosisView.save(revision.task, 'log.diagnosisRevision.edit.signautreDate',revision,revision.signatureDate)}"/>-->
        <!--                        <f:ajax event="change" execute="@this"-->
        <!--                                listener="#{diagnosisView.save(revision.task, 'log.diagnosisRevision.edit.signautreDate',revision,revision.signatureDate)}"/>-->
        <!--                    </p:calendar>-->

        <!--                    &lt;!&ndash; physician &ndash;&gt;-->
        <!--                    <h:outputLabel value="#{msg['body.diagnosis.signature.physician']}"/>-->
        <!--                    <h:panelGroup>-->
        <!--                        <p:selectOneMenu-->
        <!--                                disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                style="width:90% !important;"-->
        <!--                                panelStyleClass="iconFixForSelectOneMenu"-->
        <!--                                value="#{revision.signatureOne.physician}"-->
        <!--                                converter="#{genericViewData.physiciansToSignListTransformer}"-->
        <!--                                filter="true" filterMatchMode="contains">-->

        <!--                            <f:selectItem-->
        <!--                                    itemLabel="#{msg['body.diagnosis.signature.physician.select']}"-->
        <!--                                    itemValue="#{null}"/>-->

        <!--                            <f:selectItems-->
        <!--                                    value="#{genericViewData.physiciansToSignList}"-->
        <!--                                    var="physician" itemLabel="#{physician.person.getFullName()}"-->
        <!--                                    itemValue="#{physician}"/>-->

        <!--                            <p:ajax event="change"-->
        <!--                                    onstart="PF('submitPhysicianChange').jq.click()"/>-->

        <!--                        </p:selectOneMenu>-->

        <!--                        &lt;!&ndash; on consultant change &ndash;&gt;-->
        <!--                        <p:commandButton style="display: none"-->
        <!--                                         actionListener="#{diagnosisView.updatePhysiciansSignature(revision.task,revision.signatureOne,'log.diagnosisRevision.edit.signatureOne.update', revision, revision.signatureOne.physician.person.getFullName(), revision.signatureOne.role)}"-->
        <!--                                         update="navigationForm:patientList contentForm:contentPanel headerForm"-->
        <!--                                         widgetVar="submitPhysicianChange"/>-->
        <!--                    </h:panelGroup>-->

        <!--                    &lt;!&ndash; Consultant &ndash;&gt;-->
        <!--                    <h:outputLabel-->
        <!--                            value="#{msg['body.diagnosis.signature.consultant']}"/>-->
        <!--                    <h:panelGroup>-->
        <!--                        <p:selectOneMenu-->
        <!--                                disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                style="width:90% !important;"-->
        <!--                                panelStyleClass="iconFixForSelectOneMenu"-->
        <!--                                value="#{revision.signatureTwo.physician}"-->
        <!--                                converter="#{genericViewData.physiciansToSignListTransformer}"-->
        <!--                                filter="true" filterMatchMode="contains">-->
        <!--                            <f:selectItem-->
        <!--                                    itemLabel="#{msg['body.diagnosis.signature.consultant.select']}"-->
        <!--                                    itemValue="#{null}"/>-->

        <!--                            <f:selectItems-->
        <!--                                    value="#{genericViewData.physiciansToSignList}"-->
        <!--                                    var="physician" itemLabel="#{physician.person.getFullName()}"-->
        <!--                                    itemValue="#{physician}"/>-->

        <!--                            <p:ajax event="change"-->
        <!--                                    oncomplete="PF('submitConsultantChange').jq.click()"/>-->
        <!--                        </p:selectOneMenu>-->

        <!--                        &lt;!&ndash; on consultant change &ndash;&gt;-->
        <!--                        <p:commandButton style="display: none"-->
        <!--                                         actionListener="#{diagnosisView.updatePhysiciansSignature(revision.task,revision.signatureTwo,'log.diagnosisRevision.edit.signatureTwo.update', revision, revision.signatureTwo.physician.person.getFullName(), revision.signatureTwo.role)}"-->
        <!--                                         update="navigationForm:patientList contentForm:contentPanel headerForm"-->
        <!--                                         widgetVar="submitConsultantChange"/>-->
        <!--                    </h:panelGroup>-->

        <!--                    <h:panelGroup/>-->
        <!--                    <h:panelGroup/>-->
        <!--                    <h:panelGroup/>-->

        <!--                    &lt;!&ndash; physician role &ndash;&gt;-->
        <!--                    <h:panelGroup>-->
        <!--                        <p:selectOneMenu id="pysicianToSignRole" editable="true"-->
        <!--                                         style="width:90% !important;"-->
        <!--                                         disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                         value="#{revision.signatureOne.role}">-->
        <!--                            <f:selectItems value="#{enumProvider.signatureRoles}"-->
        <!--                                           var="signatureRole"-->
        <!--                                           itemLabel="#{msg['enum.signatureRole.'.concat(signatureRole)]}"-->
        <!--                                           itemValue="#{msg['enum.signatureRole.'.concat(signatureRole)]}"/>-->
        <!--                            <p:ajax event="change"-->
        <!--                                    onstart="PF('submitPhysicianRoleChange').jq.click()"/>-->
        <!--                        </p:selectOneMenu>-->

        <!--                        &lt;!&ndash; on physician role change &ndash;&gt;-->
        <!--                        <p:commandButton style="display: none"-->
        <!--                                         actionListener="#{diagnosisView.save(revision.task,'log.diagnosisRevision.edit.signatureOne.role',revision, revision.signatureOne.role.toString())}"-->
        <!--                                         update="navigationForm:patientList contentForm:contentPanel headerForm"-->
        <!--                                         widgetVar="submitPhysicianRoleChange"/>-->
        <!--                    </h:panelGroup>-->

        <!--                    <h:panelGroup/>-->

        <!--                    &lt;!&ndash; Consultant role &ndash;&gt;-->
        <!--                    <h:panelGroup>-->
        <!--                        <p:selectOneMenu id="consultantToSignRole" editable="true"-->
        <!--                                         style="width:90% !important"-->
        <!--                                         disabled="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionEditable(revision)}"-->
        <!--                                         value="#{revision.signatureTwo.role}">-->
        <!--                            <f:selectItems value="#{enumProvider.signatureRoles}"-->
        <!--                                           var="signatureRole"-->
        <!--                                           itemLabel="#{msg['enum.signatureRole.'.concat(signatureRole)]}"-->
        <!--                                           itemValue="#{msg['enum.signatureRole.'.concat(signatureRole)]}"/>-->
        <!--                            <p:ajax event="change"-->
        <!--                                    oncomplete="PF('submitConsultantRoleChange').jq.click()"/>-->
        <!--                        </p:selectOneMenu>-->

        <!--                        &lt;!&ndash; on consultant role change &ndash;&gt;-->
        <!--                        <p:commandButton style="display: none"-->
        <!--                                         actionListener="#{diagnosisView.save(revision.task,'log.diagnosisRevision.edit.signatureTwo.role',revision, revision.signatureTwo.role)}"-->
        <!--                                         update="navigationForm:patientList contentForm:contentPanel headerForm"-->
        <!--                                         widgetVar="submitConsultantRoleChange"/>-->
        <!--                    </h:panelGroup>-->
        <!--                </h:panelGrid>-->


        <!--                &lt;!&ndash; Buttons &ndash;&gt;-->
        <!--                <h:panelGrid columns="3" styleClass="defaultHistoTable"-->
        <!--                             id="diagnosisSpotContentButtons#{varCounterOuter.index}"-->
        <!--                             columnClasses="columnWidthMin,columnWidthMin, columnWidthAuto">-->

        <!--                    &lt;!&ndash; new diagnosis revision &ndash;&gt;-->
        <!--                    <p:commandButton widgetVar="newDiagnosisRevision#{varCounterOuter.index}"-->
        <!--                                     value="#{msg['body.diagnosis.diagnosis.new']}"-->
        <!--                                     icon="fa fa-plus-circle"-->
        <!--                                     actionListener="#{dialog.createDiagnosisRevisionDialog.initAndPrepareBean(diagnosisView.task)}">-->
        <!--                        <p:ajax event="dialogReturn"-->
        <!--                                listener="#{dialogReturnHandler.onDefaultReturn}"-->
        <!--                                update="navigationForm:patientList contentForm:contentPanel headerForm"/>-->
        <!--                    </p:commandButton>-->

        <!--                    <h:panelGroup>-->
        <!--                        &lt;!&ndash; end or reend diagnosis&ndash;&gt;-->
        <!--                        <p:splitButton-->
        <!--                                value="#{!revision.completed ? msg['body.diagnosis.diagnosis.end'] : msg['body.diagnosis.diagnosis.re_end']}"-->
        <!--                                rendered="#{!worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionInEditAmendmentMode(revision) }"-->
        <!--                                disabled="#{!diagnosisView.task.taskStatus.editable}"-->
        <!--                                onclick="$('#contentForm\\:endDiagnosisRevision#{varCounterOuter.index}').click();"-->
        <!--                                icon="fa fa-eye-slash">-->

        <!--                            &lt;!&ndash; amendment &ndash;&gt;-->
        <!--                            <p:menuitem value="#{msg['body.diagnosis.diagnosis.amendment']}"-->
        <!--                                        rendered="#{revision.completed}"-->
        <!--                                        icon="fa fa-edit"-->
        <!--                                        onclick="$('#contentForm\\:admendDiagnosisRevision#{varCounterOuter.index}').click();"-->
        <!--                                        disabled="#{!diagnosisView.task.taskStatus.editable}"/>-->

        <!--                            &lt;!&ndash; rename &ndash;&gt;-->
        <!--                            <p:menuitem-->
        <!--                                    value="#{msg['body.diagnosis.diagnosis.rename']}"-->
        <!--                                    onclick="PF('editDiagnosisRevision#{varCounterOuter.index}').jq.click();"-->
        <!--                                    icon="fa fa-pencil"-->
        <!--                                    disabled="#{!diagnosisView.task.taskStatus.editable}"/>-->


        <!--                            &lt;!&ndash; delete diagnosis &ndash;&gt;-->
        <!--                            <p:menuitem value="#{msg['body.diagnosis.diagnosis.delete']}"-->
        <!--                                        icon="fa fa-trash"-->
        <!--                                        onclick="PF('deleteRevision#{varCounterOuter.index}').jq.click();"-->
        <!--                                        disabled="#{!diagnosisView.task.taskStatus.editable}"/>-->

        <!--                            <p:separator/>-->

        <!--                            &lt;!&ndash; new staining &ndash;&gt;-->
        <!--                            <p:menuitem value="#{msg['body.diagnosis.diagnosis.slide']}"-->
        <!--                                        icon="fa fa-paint-brush"-->
        <!--                                        onclick="PF('newStaining').jq.click();"-->
        <!--                                        disabled="#{!diagnosisView.task.taskStatus.editable}"/>-->

        <!--                            <p:separator/>-->

        <!--                            &lt;!&ndash; print diagnosis &ndash;&gt;-->
        <!--                            <p:menuitem value="#{msg['body.diagnosis.diagnosis.print']}"-->
        <!--                                        icon="fa fa-print" disabled="true"/>-->
        <!--                        </p:splitButton>-->

        <!--                        &lt;!&ndash; save changes &ndash;&gt;-->
        <!--                        <p:commandButton value="#{msg['body.diagnosis.diagnosis.lock']}"-->
        <!--                                         rendered="#{worklistHandler.current.selectedTaskInfo.isDiagnosisRevisionInEditAmendmentMode(revision) }"-->
        <!--                                         oncomplete="PF('diagnosisSpotBlocker#{varCounterOuter.index}').hide()"-->
        <!--                                         icon="fa fa-check-circle-o"-->
        <!--                                         update="diagnosisSpotDiagnosis#{varCounterOuter.index} diagnosisSpotContentSignature#{varCounterOuter.index} diagnosisSpotContentButtons#{varCounterOuter.index}">-->
        <!--                            <f:actionListener-->
        <!--                                    binding="#{diagnosisView.endDiagnosisAmendment(revision)}"/>-->
        <!--                        </p:commandButton>-->

        <!--                        &lt;!&ndash; edit diagnosis revision &ndash;&gt;-->
        <!--                        <p:commandButton-->
        <!--                                widgetVar="editDiagnosisRevision#{varCounterOuter.index}"-->
        <!--                                style="display:none"-->
        <!--                                actionListener="#{dialog.editDiagnosisRevisionsDialog.initAndPrepareBean(worklistHandler.current.selectedTask,revision)}">-->
        <!--                            <p:ajax event="dialogReturn"-->
        <!--                                    listener="#{dialogReturnHandler.onDefaultReturn}"-->
        <!--                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>-->
        <!--                        </p:commandButton>-->

        <!--                        &lt;!&ndash; delete diagnosis revision &ndash;&gt;-->
        <!--                        <p:commandButton widgetVar="deleteRevision#{varCounterOuter.index}"-->
        <!--                                         style="display:none"-->
        <!--                                         actionListener="#{dialog.deleteDiagnosisRevisionDialog.initAndPrepareBean(revision)}">-->
        <!--                            <p:ajax event="dialogReturn"-->
        <!--                                    listener="#{dialogReturnHandler.onDefaultReturn}"-->
        <!--                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>-->
        <!--                        </p:commandButton>-->

        <!--                        &lt;!&ndash; adment revision &ndash;&gt;-->
        <!--                        <p:commandButton style="display:none"-->
        <!--                                         id="admendDiagnosisRevision#{varCounterOuter.index}"-->
        <!--                                         oncomplete="PF('diagnosisSpotBlocker#{varCounterOuter.index}').show()"-->
        <!--                                         update="diagnosisSpotDiagnosis#{varCounterOuter.index} diagnosisSpotContentSignature#{varCounterOuter.index} diagnosisSpotContentButtons#{varCounterOuter.index}">-->
        <!--                            <f:actionListener-->
        <!--                                    binding="#{diagnosisView.beginDiagnosisAmendment(revision)}"/>-->
        <!--                        </p:commandButton>-->

        <!--                        &lt;!&ndash; new staining &ndash;&gt;-->
        <!--                        <p:commandButton style="display:none"-->
        <!--                                         id="newStaining" widgetVar="newStaining"-->
        <!--                                         actionListener="#{slideOverviewDialog.initAndPrepareBean(worklistHandler.current.selectedTask)}">-->
        <!--                            <p:ajax event="dialogReturn"-->
        <!--                                    listener="#{dialogReturnHandler.onDefaultReturn}"-->
        <!--                                    update="navigationForm:patientList contentForm headerForm"/>-->
        <!--                        </p:commandButton>-->

        <!--                        &lt;!&ndash; end diangosis &ndash;&gt;-->
        <!--                        <p:commandButton id="endDiagnosisRevision#{varCounterOuter.index}"-->
        <!--                                         style="display:none"-->
        <!--                                         actionListener="#{diagnosisPhaseExitDialog.initAndPrepareBean(worklistHandler.current.selectedTask, revision)}">-->
        <!--                            <p:ajax event="dialogReturn"-->
        <!--                                    listener="#{dialogReturnHandler.onDefaultReturn}"-->
        <!--                                    update="navigationForm:patientList contentForm:contentPanel headerForm"/>-->
        <!--                        </p:commandButton>-->

        <!--                    </h:panelGroup>-->

        <!--                    &lt;!&ndash; status icons &ndash;&gt;-->
        <!--                    <h:panelGroup>-->
        <!--                        <h:panelGroup id="diagnosisCompleted#{varCounterOuter.index}">-->
        <!--                            <i class="fa fa-fw fa-rss-square fa-lg #{revision.completed ? 'icon-green' : 'icon-grey'}"-->
        <!--                               title=""/>-->
        <!--                            <p:tooltip for="diagnosisCompleted#{varCounterOuter.index}">-->
        <!--                                <h:outputLabel-->
        <!--                                        value="#{revision.completed ? msg['body.diagnosis.diagnosis.approved'] : msg['body.diagnosis.diagnosis.approved.not']} "/>-->
        <!--                                <h:outputText rendered="#{revision.completed}"-->
        <!--                                              value="#{revision.completionDate}">-->
        <!--                                    <f:converter converterId="instantDateTimeConverter"/>-->
        <!--                                    <f:attribute name="pattern" value="dd.MM.yyyy HH:mm"/>-->
        <!--                                </h:outputText>-->
        <!--                            </p:tooltip>-->
        <!--                        </h:panelGroup>-->

        <!--                        &lt;!&ndash; nofitication complete date &ndash;&gt;-->
        <!--                        <h:panelGroup id="notificationsCompleted#{varCounterOuter.index}">-->
        <!--                            <h:panelGroup-->
        <!--                                    rendered="#{revision.notificationStatus != 'NO_NOTFICATION'}">-->
        <!--                                <i class="fa fa-fw fa-volume-up fa-lg #{revision.notified ? 'icon-green' : 'icon-grey'}"-->
        <!--                                   title=""/>-->
        <!--                                <p:tooltip for="notificationsCompleted#{varCounterOuter.index}">-->
        <!--                                    <h:outputLabel-->
        <!--                                            value="#{revision.notified ? msg['body.diagnosis.diagnosis.notification'] : msg['body.diagnosis.diagnosis.notification.not']} "/>-->
        <!--                                    <h:outputText rendered="#{revision.notified}"-->
        <!--                                                  value="#{revision.notificationDate}">-->
        <!--                                        <f:converter converterId="instantDateTimeConverter"/>-->
        <!--                                        <f:attribute name="pattern" value="dd.MM.yyyy HH:mm"/>-->
        <!--                                    </h:outputText>-->
        <!--                                </p:tooltip>-->
        <!--                            </h:panelGroup>-->

        <!--                            &lt;!&ndash; no notification necessary &ndash;&gt;-->
        <!--                            <h:panelGroup-->
        <!--                                    rendered="#{revision.notificationStatus == 'NO_NOTFICATION'}">-->
        <!--                                <i class="fa fa-fw fa-stack-exchange fa-lg icon-orange"/>-->
        <!--                                <p:tooltip for="notificationsCompleted#{varCounterOuter.index}">-->
        <!--                                    <h:outputLabel value="Keine Benachrichtigung druchgefhrt"/>-->
        <!--                                </p:tooltip>-->
        <!--                            </h:panelGroup>-->
        <!--                        </h:panelGroup>-->

        <!--                    </h:panelGroup>-->
        <!--                </h:panelGrid>-->

        <!--            </h:panelGrid>-->
        <!--        </c:forEach>-->
        <!-- commands -->
    </p:panel>

    <script type="application/javascript">

        function disabledEventPropagation(event) {
            if (event.stopPropagation) {
                event.stopPropagation();
            } else if (window.event) {
                window.event.cancelBubble = true;
            }
        }

    </script>

</ui:composition>

